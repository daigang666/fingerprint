var Fingerprint=(function(exports){'use strict';var v="DEVICE_FINGERPRINT",M="DeviceFingerprintDB",G="fingerprints";var U="X-Device-Fingerprint";function d(i,n){return i+n&4294967295}function F(i,n,e,r,t,o){let s=d(d(n,i),d(r,o));return d(s<<t|s>>>32-t,e)}function c(i,n,e,r,t,o,s){return F(n&e|~n&r,i,n,t,o,s)}function l(i,n,e,r,t,o,s){return F(n&r|e&~r,i,n,t,o,s)}function u(i,n,e,r,t,o,s){return F(n^e^r,i,n,t,o,s)}function m(i,n,e,r,t,o,s){return F(e^(n|~r),i,n,t,o,s)}function V(i,n){let e=i[0],r=i[1],t=i[2],o=i[3];e=c(e,r,t,o,n[0],7,-680876936),o=c(o,e,r,t,n[1],12,-389564586),t=c(t,o,e,r,n[2],17,606105819),r=c(r,t,o,e,n[3],22,-1044525330),e=c(e,r,t,o,n[4],7,-176418897),o=c(o,e,r,t,n[5],12,1200080426),t=c(t,o,e,r,n[6],17,-1473231341),r=c(r,t,o,e,n[7],22,-45705983),e=c(e,r,t,o,n[8],7,1770035416),o=c(o,e,r,t,n[9],12,-1958414417),t=c(t,o,e,r,n[10],17,-42063),r=c(r,t,o,e,n[11],22,-1990404162),e=c(e,r,t,o,n[12],7,1804603682),o=c(o,e,r,t,n[13],12,-40341101),t=c(t,o,e,r,n[14],17,-1502002290),r=c(r,t,o,e,n[15],22,1236535329),e=l(e,r,t,o,n[1],5,-165796510),o=l(o,e,r,t,n[6],9,-1069501632),t=l(t,o,e,r,n[11],14,643717713),r=l(r,t,o,e,n[0],20,-373897302),e=l(e,r,t,o,n[5],5,-701558691),o=l(o,e,r,t,n[10],9,38016083),t=l(t,o,e,r,n[15],14,-660478335),r=l(r,t,o,e,n[4],20,-405537848),e=l(e,r,t,o,n[9],5,568446438),o=l(o,e,r,t,n[14],9,-1019803690),t=l(t,o,e,r,n[3],14,-187363961),r=l(r,t,o,e,n[8],20,1163531501),e=l(e,r,t,o,n[13],5,-1444681467),o=l(o,e,r,t,n[2],9,-51403784),t=l(t,o,e,r,n[7],14,1735328473),r=l(r,t,o,e,n[12],20,-1926607734),e=u(e,r,t,o,n[5],4,-378558),o=u(o,e,r,t,n[8],11,-2022574463),t=u(t,o,e,r,n[11],16,1839030562),r=u(r,t,o,e,n[14],23,-35309556),e=u(e,r,t,o,n[1],4,-1530992060),o=u(o,e,r,t,n[4],11,1272893353),t=u(t,o,e,r,n[7],16,-155497632),r=u(r,t,o,e,n[10],23,-1094730640),e=u(e,r,t,o,n[13],4,681279174),o=u(o,e,r,t,n[0],11,-358537222),t=u(t,o,e,r,n[3],16,-722521979),r=u(r,t,o,e,n[6],23,76029189),e=u(e,r,t,o,n[9],4,-640364487),o=u(o,e,r,t,n[12],11,-421815835),t=u(t,o,e,r,n[15],16,530742520),r=u(r,t,o,e,n[2],23,-995338651),e=m(e,r,t,o,n[0],6,-198630844),o=m(o,e,r,t,n[7],10,1126891415),t=m(t,o,e,r,n[14],15,-1416354905),r=m(r,t,o,e,n[5],21,-57434055),e=m(e,r,t,o,n[12],6,1700485571),o=m(o,e,r,t,n[3],10,-1894986606),t=m(t,o,e,r,n[10],15,-1051523),r=m(r,t,o,e,n[1],21,-2054922799),e=m(e,r,t,o,n[8],6,1873313359),o=m(o,e,r,t,n[15],10,-30611744),t=m(t,o,e,r,n[6],15,-1560198380),r=m(r,t,o,e,n[13],21,1309151649),e=m(e,r,t,o,n[4],6,-145523070),o=m(o,e,r,t,n[11],10,-1120210379),t=m(t,o,e,r,n[2],15,718787259),r=m(r,t,o,e,n[9],21,-343485551),i[0]=d(e,i[0]),i[1]=d(r,i[1]),i[2]=d(t,i[2]),i[3]=d(o,i[3]);}function K(i){let n=[];for(let e=0;e<64;e+=4)n[e>>2]=i.charCodeAt(e)+(i.charCodeAt(e+1)<<8)+(i.charCodeAt(e+2)<<16)+(i.charCodeAt(e+3)<<24);return n}function X(i){let n="0123456789abcdef",e="";for(let r=0;r<4;r++)e+=n.charAt(i>>r*8+4&15)+n.charAt(i>>r*8&15);return e}function W(i){return i.map(X).join("")}function q(i){return unescape(encodeURIComponent(i))}function O(i){let n=q(i),e=n.length,r=[1732584193,-271733879,-1732584194,271733878],t;for(t=64;t<=e;t+=64)V(r,K(n.substring(t-64,t)));let o=n.substring(t-64),s=Array(16).fill(0);for(t=0;t<o.length;t++)s[t>>2]|=o.charCodeAt(t)<<(t%4<<3);return s[t>>2]|=128<<(t%4<<3),t>55&&(V(r,s),s.fill(0)),s[14]=e*8,V(r,s),W(r)}function j(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID().replace(/-/g,""):"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/x/g,()=>Math.floor(Math.random()*16).toString(16))}var C=class{constructor(){this.name="canvas";}isKnownNoisyBrowser(){let e=navigator.userAgent.match(/Version\/(\d+).*Safari/);return !!(e&&parseInt(e[1],10)>=17)}async collect(n){try{if(this.isKnownNoisyBrowser())return {name:this.name,value:"",success:!1,error:"Browser known for canvas anti-fingerprinting"};let e=document.createElement("canvas"),r=e.getContext("2d");if(!r)return {name:this.name,value:"",success:!1,error:"Canvas context not available"};e.width=200,e.height=50,r.fillStyle="#f60",r.fillRect(0,0,200,50),r.fillStyle="#069",r.font="14px Arial",r.fillText("Device Fingerprint Canvas",2,15),r.fillStyle="rgba(102, 204, 0, 0.7)",r.font="18px Times New Roman",r.fillText("!@#$%^&*()_+-=[]{}|;:",4,35),r.beginPath(),r.arc(150,25,20,0,Math.PI*2,!0),r.closePath(),r.fillStyle="#ff0",r.fill(),r.shadowBlur=10,r.shadowColor="blue",r.fillRect(160,10,30,30);let t=e.toDataURL("image/png"),o=e.toDataURL("image/png");return t!==o?{name:this.name,value:"",success:!1,error:"Canvas noise detected (unstable)"}:{name:this.name,value:t,success:!0}}catch(e){return {name:this.name,value:"",success:false,error:e instanceof Error?e.message:"Unknown error"}}}};var w=class{constructor(){this.name="webgl";}async collect(n){try{let e=document.createElement("canvas"),r=e.getContext("webgl")||e.getContext("experimental-webgl");if(!r)return {name:this.name,value:"",success:!1,error:"WebGL not available"};let t=r,o=t.getExtension("WEBGL_debug_renderer_info"),s=[];if(o){let p=t.getParameter(o.UNMASKED_VENDOR_WEBGL),g=t.getParameter(o.UNMASKED_RENDERER_WEBGL);s.push(`vendor:${p}`),s.push(`renderer:${g}`);}s.push(`version:${t.getParameter(t.VERSION)}`),s.push(`shadingLanguageVersion:${t.getParameter(t.SHADING_LANGUAGE_VERSION)}`),s.push(`maxTextureSize:${t.getParameter(t.MAX_TEXTURE_SIZE)}`),s.push(`maxRenderbufferSize:${t.getParameter(t.MAX_RENDERBUFFER_SIZE)}`),s.push(`maxViewportDims:${t.getParameter(t.MAX_VIEWPORT_DIMS)}`),s.push(`maxVertexAttribs:${t.getParameter(t.MAX_VERTEX_ATTRIBS)}`),s.push(`maxVertexUniformVectors:${t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS)}`),s.push(`maxFragmentUniformVectors:${t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS)}`);let f=t.getSupportedExtensions()||[];return s.push(`extensions:${f.sort().join(",")}`),{name:this.name,value:s.join("|"),success:!0}}catch(e){return {name:this.name,value:"",success:false,error:e instanceof Error?e.message:"Unknown error"}}}};var y=class{constructor(){this.name="audio";}isKnownNoisyBrowser(){let n=navigator.userAgent,e=n.match(/Version\/(\d+).*Safari/);if(e&&parseInt(e[1],10)>=17)return  true;let r=n.match(/SamsungBrowser\/(\d+)/);return !!(r&&parseInt(r[1],10)>=26)}async collect(n){try{if(this.isKnownNoisyBrowser())return {name:this.name,value:"",success:!1,error:"Browser known for audio anti-fingerprinting"};let e=window.OfflineAudioContext||window.webkitOfflineAudioContext;if(!e)return {name:this.name,value:"",success:!1,error:"OfflineAudioContext not available"};let r=44100,o=r*.5,s=new e(1,o,r),f=s.createOscillator();f.type="triangle",f.frequency.setValueAtTime(1e4,s.currentTime);let p=s.createDynamicsCompressor();p.threshold.setValueAtTime(-50,s.currentTime),p.knee.setValueAtTime(40,s.currentTime),p.ratio.setValueAtTime(12,s.currentTime),p.attack.setValueAtTime(0,s.currentTime),p.release.setValueAtTime(.25,s.currentTime),f.connect(p),p.connect(s.destination),f.start(0);let b=(await s.startRendering()).getChannelData(0),a=[],N=[4500,5e3,5500,6e3,6500,7e3,7500,8e3,8500,9e3,9500,1e4,10500,11e3,11500,12e3,12500,13e3,13500,14e3];for(let h of N)h<b.length&&a.push(b[h]);let A=a.reduce((h,B)=>h+B,0)/a.length,$=a.reduce((h,B)=>h+Math.pow(B-A,2),0)/a.length,H=[...a.map(h=>h.toFixed(8)),`avg:${A.toFixed(8)}`,`var:${$.toFixed(8)}`].join(",");return {name:this.name,value:H,success:!0}}catch(e){return {name:this.name,value:"",success:false,error:e instanceof Error?e.message:"Unknown error"}}}};var E=class{constructor(){this.name="screen";}isSafari17Plus(){let e=navigator.userAgent.match(/Version\/(\d+).*Safari/);return !!(e&&parseInt(e[1],10)>=17)}async collect(n){try{let e=[];this.isSafari17Plus()||(e.push(`width:${screen.width}`),e.push(`height:${screen.height}`),e.push(`availWidth:${screen.availWidth}`),e.push(`availHeight:${screen.availHeight}`)),e.push(`colorDepth:${screen.colorDepth}`),e.push(`pixelDepth:${screen.pixelDepth}`),e.push(`devicePixelRatio:${window.devicePixelRatio||1}`),screen.orientation&&e.push(`orientation:${screen.orientation.type}`);let t=navigator.maxTouchPoints||0;return e.push(`maxTouchPoints:${t}`),e.push(`touchSupport:${t>0}`),{name:this.name,value:e.join("|"),success:!0}}catch(e){return {name:this.name,value:"",success:false,error:e instanceof Error?e.message:"Unknown error"}}}};var R=class{constructor(){this.name="system";}async collect(n){try{let e=[];n?.strictBrowserMode&&e.push(`userAgent:${navigator.userAgent}`),e.push(`timezone:${Intl.DateTimeFormat().resolvedOptions().timeZone}`),e.push(`timezoneOffset:${new Date().getTimezoneOffset()}`),e.push(`language:${navigator.language}`),e.push(`hardwareConcurrency:${navigator.hardwareConcurrency||"unknown"}`);let r=navigator.deviceMemory;r&&e.push(`deviceMemory:${r}`),e.push(`platform:${navigator.platform}`),e.push(`cookieEnabled:${navigator.cookieEnabled}`),e.push(`javaEnabled:${typeof navigator.javaEnabled=="function"?navigator.javaEnabled():!1}`);let t=navigator.doNotTrack||window.doNotTrack;return e.push(`doNotTrack:${t||"unknown"}`),e.push(`pdfViewerEnabled:${navigator.pdfViewerEnabled??"unknown"}`),e.push(`webdriver:${navigator.webdriver||!1}`),{name:this.name,value:e.join("|"),success:!0}}catch(e){return {name:this.name,value:"",success:false,error:e instanceof Error?e.message:"Unknown error"}}}};function L(){return [new C,new w,new y,new E,new R]}var S=class{constructor(n){this.key=n?`${n}_${v}`:v;}async get(){try{let n=localStorage.getItem(this.key);return n?JSON.parse(n):null}catch{return null}}async set(n){try{localStorage.setItem(this.key,JSON.stringify(n));}catch(e){console.warn("[Fingerprint] Failed to save to localStorage:",e);}}async clear(){try{localStorage.removeItem(this.key);}catch{}}};var P=class{constructor(n){this.db=null;this.dbName=n?`${n}_${M}`:M,this.storeName=G,this.key=v;}async openDB(){return this.db?this.db:new Promise((n,e)=>{let r=indexedDB.open(this.dbName,1);r.onerror=()=>{e(new Error("Failed to open IndexedDB"));},r.onsuccess=()=>{this.db=r.result,n(r.result);},r.onupgradeneeded=t=>{let o=t.target.result;o.objectStoreNames.contains(this.storeName)||o.createObjectStore(this.storeName,{keyPath:"id"});};})}async get(){try{let n=await this.openDB();return new Promise(e=>{let o=n.transaction(this.storeName,"readonly").objectStore(this.storeName).get(this.key);o.onerror=()=>{e(null);},o.onsuccess=()=>{let s=o.result;s&&s.data?e(s.data):e(null);};})}catch{return null}}async set(n){try{let e=await this.openDB();return new Promise((r,t)=>{let f=e.transaction(this.storeName,"readwrite").objectStore(this.storeName).put({id:this.key,data:n});f.onerror=()=>{t(new Error("Failed to save to IndexedDB"));},f.onsuccess=()=>{r();};})}catch(e){console.warn("[Fingerprint] Failed to save to IndexedDB:",e);}}async clear(){try{let n=await this.openDB();return new Promise(e=>{n.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(this.key),e();})}catch{}}};var D=class{constructor(n={}){this.cachedResult=null;this.config={cacheExpiry:n.cacheExpiry??63072e7,enableIndexedDB:n.enableIndexedDB??true,storageKeyPrefix:n.storageKeyPrefix??"df",version:n.version??1,strictBrowserMode:n.strictBrowserMode??false,debug:n.debug??false},this.collectors=L(),this.localStorage=new S(this.config.storageKeyPrefix),this.indexedDB=this.config.enableIndexedDB?new P(this.config.storageKeyPrefix):null;}async getFingerprint(){if(this.cachedResult&&!this.isExpired(this.cachedResult.expiresAt))return this.cachedResult;let n=await this.localStorage.get();if(n&&!this.isExpired(n.expiresAt))return this.cachedResult=this.toResult(n),this.cachedResult;if(this.indexedDB){let e=await this.indexedDB.get();if(e&&!this.isExpired(e.expiresAt))return await this.localStorage.set(e),this.cachedResult=this.toResult(e),this.cachedResult}return this.collectAndCache()}async refresh(){return this.collectAndCache()}async clear(){this.cachedResult=null,await this.localStorage.clear(),this.indexedDB&&await this.indexedDB.clear();}async collectAndCache(){let{fingerprint:n,isFallback:e,debugInfo:r}=await this.collect(),t=Date.now(),o={fingerprint:n,isFallback:e,createdAt:t,expiresAt:t+this.config.cacheExpiry,version:this.config.version};return await this.localStorage.set(o),this.indexedDB&&await this.indexedDB.set(o),this.cachedResult=this.toResult(o,r),this.cachedResult}async collect(){let n=performance.now(),e=[];this.config.debug&&(console.group("[Fingerprint] \u5F00\u59CB\u91C7\u96C6\u6307\u7EB9"),console.log("\u914D\u7F6E:",this.config),console.log("User-Agent:",navigator.userAgent));try{let r={strictBrowserMode:this.config.strictBrowserMode},o=(await Promise.all(this.collectors.map(async g=>{let b=performance.now(),a=await g.collect(r),N=performance.now()-b,x={name:a.name,success:a.success,duration:Math.round(N*100)/100,value:a.value?a.value.substring(0,200):"",valueLength:a.value?.length||0,valueHash:a.value?O(a.value):"",error:a.error};if(e.push(x),this.config.debug){let A=a.success?"\u2713":"\u2717",$=a.success?"color: #10b981":"color: #ef4444";console.log(`%c${A} ${a.name}`,$,`| \u8017\u65F6: ${x.duration}ms`,`| \u957F\u5EA6: ${x.valueLength}`,`| \u54C8\u5E0C: ${x.valueHash.substring(0,8)}...`,a.error?`| \u9519\u8BEF: ${a.error}`:""),console.log("  \u2514\u2500 \u539F\u59CB\u503C:",a.value||"(\u7A7A)");}return a}))).filter(g=>g.success&&g.value);if(o.length===0){let g=j(),b=Math.round((performance.now()-n)*100)/100;return this.config.debug&&(console.warn("[Fingerprint] \u6240\u6709\u91C7\u96C6\u5668\u5931\u8D25\uFF0C\u4F7F\u7528\u515C\u5E95 UUID:",g),console.log(`[Fingerprint] \u603B\u8017\u65F6: ${b}ms`),console.groupEnd()),{fingerprint:g,isFallback:!0,debugInfo:this.config.debug?{duration:b,collectors:e,rawData:"",userAgent:navigator.userAgent}:void 0}}let s=o.map(g=>`${g.name}:${g.value}`).sort().join("|"),f=O(s),p=Math.round((performance.now()-n)*100)/100;return this.config.debug&&(console.log("[Fingerprint] \u6210\u529F\u91C7\u96C6\u5668:",o.map(g=>g.name).join(", ")),console.log("[Fingerprint] \u539F\u59CB\u6570\u636E\u957F\u5EA6:",s.length),console.log("[Fingerprint] \u6700\u7EC8\u6307\u7EB9:",f),console.log(`[Fingerprint] \u603B\u8017\u65F6: ${p}ms`),console.groupEnd()),{fingerprint:f,isFallback:!1,debugInfo:this.config.debug?{duration:p,collectors:e,rawData:s,userAgent:navigator.userAgent}:void 0}}catch(r){let t=Math.round((performance.now()-n)*100)/100,o=j();return this.config.debug?(console.error("[Fingerprint] \u91C7\u96C6\u5F02\u5E38:",r),console.warn("[Fingerprint] \u4F7F\u7528\u515C\u5E95 UUID:",o),console.log(`[Fingerprint] \u603B\u8017\u65F6: ${t}ms`),console.groupEnd()):console.warn("[Fingerprint] Collection failed, using fallback UUID:",r),{fingerprint:o,isFallback:true,debugInfo:this.config.debug?{duration:t,collectors:e,rawData:"",userAgent:navigator.userAgent}:void 0}}}isExpired(n){return Date.now()>n}toResult(n,e){let r={fingerprint:n.fingerprint,isFallback:n.isFallback,timestamp:n.createdAt,expiresAt:n.expiresAt};return e&&(r.debug=e),r}};var T=null;function Te(i){T=new D(i);}function _(){return T||(T=new D),T}async function _e(){return _().getFingerprint()}async function Ne(){return (await _().getFingerprint()).fingerprint}async function $e(){return _().refresh()}async function Be(){return _().clear()}function Me(){return U}exports.HTTP_HEADER_NAME=U;exports.clearFingerprint=Be;exports.getDeviceFingerprint=_e;exports.getFingerprint=Ne;exports.getHeaderName=Me;exports.initFingerprint=Te;exports.refreshFingerprint=$e;return exports;})({});//# sourceMappingURL=index.browser.js.map
//# sourceMappingURL=index.browser.js.map